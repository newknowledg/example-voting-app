pipeline {
	
	agent any

	tools{
		nodejs 'Node JS'
	}

	stages{
		
		stage(build){
			when{
				changeset "**/result/**"
			}
			steps{
				echo "Compiling result"

				dir('result'){
					sh 'npm install'
				}
			}
		}
		stage(test){
			when{
				changeset "**/result/**"
			}
			steps{
				echo "Testing result"

				dir('result'){
					sh 'npm install'
					sh 'npm test'
				}
			}
		}
		stage(docker-build){
			when{
				changeset "**/result/**"
			}
			steps{
                echo 'packaging result app with docker'
                def resultImage = docker.build("result:${env.BUILD_ID}, "./result")
			}
		}
	}
}
